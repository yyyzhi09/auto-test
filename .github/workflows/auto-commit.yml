name: Auto Commit

on:
  schedule:
    - cron: "30 6 1-31/3 * *"  # æ¯3å¤©æ‰§è¡Œä¸€æ¬¡ï¼ˆUTC 7 ç‚¹ï¼‰
  workflow_dispatch:   

jobs:
  auto-commit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

        # â‘  éšæœºå»¶è¿Ÿ 0â€“3 å°æ—¶ï¼ˆ10800 ç§’ï¼‰
      - name: Random delay (0â€“3 hours)
        run: |
          delay=$((RANDOM % 10800))
          echo "â³ Random delay for $delay seconds..."
          sleep $delay
          
      # â‘¡ ç”Ÿæˆéšæœºæ¯æ—¥è¯­å½•
      - name: Generate random quote
        id: quote
        run: |
          QUOTES=(
            "Stay hungry, stay foolish."
            "Simplicity is the soul of efficiency."
            "The best time to plant a tree was 20 years ago. The second best time is now."
            "Do one thing every day that scares you."
            "Code is like humor. When you have to explain it, itâ€™s bad."
            "The quieter you become, the more you are able to hear."
            "Dream big. Work hard. Stay humble."
          )
          RANDOM_INDEX=$((RANDOM % ${#QUOTES[@]}))
          echo "quote=${QUOTES[$RANDOM_INDEX]}" >> $GITHUB_OUTPUT

       # ðŸ’¡ æ¯æœˆ1å·æ¸…ç©ºæ–‡ä»¶
      - name: Clean up keepalive.txt on 1st day of month
        run: |
          day=$(TZ='Asia/Shanghai' date +%d)
          if [ "$day" -eq 1 ]; then
            echo "ðŸ§¹ It's the 1st day of the month â€” clearing keepalive.txt"
            > keepalive.txt
          else
            echo "Not the 1st day ($day), skip cleanup."
          fi
          
      - name: Set git config
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Make changes
        run: |
          echo "$(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S') - ${{ steps.quote.outputs.quote }}" >> keepalive.txt


      - name: Commit changes
        run: |
          git add .
          git commit -m "ðŸŒ¿ auto commit on $(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')" || echo "No changes to commit"
          git push

